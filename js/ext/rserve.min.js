"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var unsavedChanges=[];function initDeleteRScript(){$("#r-script-delete-btn").off("click").on("click",(function(t){t.preventDefault(),deleteScript()}))}function deleteScript(){var t=$('input[name="generated_id"]').val();t?$.confirm({title:"Delete script: <code>"+t+"</code>",type:"red",content:"<p>This will delete the script <code>"+t+'</code> and all the jobs related to this script will not work.</p><p>You must be absolutely certain that this is what you want. This operation cannot be undone! To verify, enter the generated id of the script.</p> <input id="deleteValue" type="text" class="form-control" >',buttons:{confirm:function(){$("#deleteValue").val()==t?location.href=$("#r-script-delete-btn").attr("href"):$.alert({title:"Delete Script: "+t,type:"red",content:"Failed to delete the script: The verification text does not match with the survey name."})},cancel:function(){}}}):$.alert({title:"Delete script: <code>"+t+"</code>",type:"red",content:"Something went wrong!"})}function initRScriptsTable(){$("#r-scripts").DataTable({order:[[0,"asc"]]}).on("click",'tr[id|="r-script-url"]',(function(t){var e=$(this).attr("id").split("-");document.location=window.location+"/update/"+parseInt(e[3])}))}function initREditor(){if($(".r-script").length>0){$(".r-script-value textarea").addClass("d-none");var t=$(".r-script")[0];require.config({paths:{vs:BASE_PATH+"/js/ext/vs"}}),require(["vs/editor/editor.main"],(function(){var e=_defineProperty({value:$(".r-script-value textarea").val(),language:"r",automaticLayout:!0,renderLineHighlight:"none"},"automaticLayout",!0),n=monaco.editor.create(t,e);n.getAction("editor.action.formatDocument").run().then((function(){calcMonacoEditorSize(n,t)})),n.onDidChangeModelContent((function(t){$(".r-script-value textarea").val(n.getValue()),$(".r-script-value textarea").trigger("change")}))}))}}function initTestScriptBtn(){$("#r-script-test-btn").off("click").on("click",(function(t){t.preventDefault(),test_r_script()}))}function test_r_script(){var t=$("#r-script-test-btn")[0],e=$(t).html();$(t).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"> </span> '+e);var n=$('input[name="generated_id"]').val();$.post(window.location,{mode:"test_script",script:$(".r-script-value textarea").val(),test_variables:$(".r-script-test-variables textarea").val()},(function(i){$(t).html(e),i.result?$.alert({title:"Successful execution - R Script: "+n,type:"green",content:"<p class='pre-wrap'>"+JSON.stringify(i,null,3)+"</p>"}):$.alert({title:"Error in R Script: "+n,type:"red",content:"<p class='pre-wrap'>"+JSON.stringify(i,null,3)+"</p>"})}),"json").fail((function(i){console.log(i.responseText),$(t).html(e),$.alert({title:"The script was not executed: "+n,type:"red",content:"<p class='pre-wrap'>Something went wrong! <br> "+i.responseText+"</p>"})}))}function initUnsavedChangesListener(){$(window).bind("beforeunload",(function(t){if(unsavedChanges.length>0)return!1})),$("input").on("change",(function(){unsavedChanges.push(this)})),$("textarea").on("change",(function(){unsavedChanges.push(this)})),$("#section-r-script-form").find(":submit").on("click",(function(){unsavedChanges=[]}))}$(document).ready((function(){initRScriptsTable(),initDeleteRScript(),initREditor(),initTestScriptBtn(),initUnsavedChangesListener()}));